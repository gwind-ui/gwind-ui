import{i as L,b as B,o as _}from"./useForwardExpose-BfXw-hnz.js";import{P as F}from"./Primitive-BG2Gt-GN.js";import{h as g}from"./handleAndDispatchCustomEvent-ChOKVcqp.js";import{r as P,s as h,F as O,q as b,d as T,c as D,B as S,b as x,o as W,j as k,g as I,f as E,G as q}from"./vue.esm-bundler-CDO2oHXK.js";const A="dismissableLayer.pointerDownOutside",z="dismissableLayer.focusOutside";function C(n,s){const a=s.closest("[data-dismissable-layer]"),t=n.dataset.dismissableLayer===""?n:n.querySelector("[data-dismissable-layer]"),r=Array.from(n.ownerDocument.querySelectorAll("[data-dismissable-layer]"));return!!(a&&(t===a||r.indexOf(t)<r.indexOf(a)))}function R(n,s,a=!0){var c;const t=((c=s==null?void 0:s.value)==null?void 0:c.ownerDocument)??(globalThis==null?void 0:globalThis.document),r=P(!1),i=P(()=>{});return h(o=>{if(!L||!O(a))return;const u=async v=>{const w=v.target;if(!(!(s!=null&&s.value)||!w)){if(C(s.value,w)){r.value=!1;return}if(v.target&&!r.value){let p=function(){g(A,n,m)};const m={originalEvent:v};v.pointerType==="touch"?(t.removeEventListener("click",i.value),i.value=p,t.addEventListener("click",i.value,{once:!0})):p()}else t.removeEventListener("click",i.value);r.value=!1}},f=window.setTimeout(()=>{t.addEventListener("pointerdown",u)},0);o(()=>{window.clearTimeout(f),t.removeEventListener("pointerdown",u),t.removeEventListener("click",i.value)})}),{onPointerDownCapture:()=>{O(a)&&(r.value=!0)}}}function K(n,s,a=!0){var i;const t=((i=s==null?void 0:s.value)==null?void 0:i.ownerDocument)??(globalThis==null?void 0:globalThis.document),r=P(!1);return h(c=>{if(!L||!O(a))return;const o=async u=>{if(!(s!=null&&s.value))return;await b(),await b();const f=u.target;!s.value||!f||C(s.value,f)||u.target&&!r.value&&g(z,n,{originalEvent:u})};t.addEventListener("focusin",o),c(()=>t.removeEventListener("focusin",o))}),{onFocusCapture:()=>{O(a)&&(r.value=!0)},onBlurCapture:()=>{O(a)&&(r.value=!1)}}}const d=S({layersRoot:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set});var U=T({__name:"DismissableLayer",props:{disableOutsidePointerEvents:{type:Boolean,required:!1,default:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1}},emits:["escapeKeyDown","pointerDownOutside","focusOutside","interactOutside","dismiss"],setup(n,{emit:s}){const a=n,t=s,{forwardRef:r,currentElement:i}=B(),c=D(()=>{var e;return((e=i.value)==null?void 0:e.ownerDocument)??globalThis.document}),o=D(()=>d.layersRoot),u=D(()=>i.value?Array.from(o.value).indexOf(i.value):-1),f=D(()=>d.layersWithOutsidePointerEventsDisabled.size>0),v=D(()=>{const e=Array.from(o.value),[y]=[...d.layersWithOutsidePointerEventsDisabled].slice(-1),l=e.indexOf(y);return u.value>=l}),w=R(async e=>{const y=[...d.branches].some(l=>l==null?void 0:l.contains(e.target));!v.value||y||(t("pointerDownOutside",e),t("interactOutside",e),await b(),e.defaultPrevented||t("dismiss"))},i),m=K(e=>{[...d.branches].some(l=>l==null?void 0:l.contains(e.target))||(t("focusOutside",e),t("interactOutside",e),e.defaultPrevented||t("dismiss"))},i);_("Escape",e=>{u.value===o.value.size-1&&(t("escapeKeyDown",e),e.defaultPrevented||t("dismiss"))});let p;return h(e=>{i.value&&(a.disableOutsidePointerEvents&&(d.layersWithOutsidePointerEventsDisabled.size===0&&(p=c.value.body.style.pointerEvents,c.value.body.style.pointerEvents="none"),d.layersWithOutsidePointerEventsDisabled.add(i.value)),o.value.add(i.value),e(()=>{a.disableOutsidePointerEvents&&d.layersWithOutsidePointerEventsDisabled.size===1&&(c.value.body.style.pointerEvents=p)}))}),h(e=>{e(()=>{i.value&&(o.value.delete(i.value),d.layersWithOutsidePointerEventsDisabled.delete(i.value))})}),(e,y)=>(W(),x(E(F),{ref:E(r),"as-child":e.asChild,as:e.as,"data-dismissable-layer":"",style:q({pointerEvents:f.value?v.value?"auto":"none":void 0}),onFocusCapture:E(m).onFocusCapture,onBlurCapture:E(m).onBlurCapture,onPointerdownCapture:E(w).onPointerDownCapture},{default:k(()=>[I(e.$slots,"default")]),_:3},8,["as-child","as","style","onFocusCapture","onBlurCapture","onPointerdownCapture"]))}}),G=U;export{G as D,d as c};
