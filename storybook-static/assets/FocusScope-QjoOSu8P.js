import{g as p}from"./getActiveElement-FUKBWQwh.js";import{r as g,d as S,C as _,s as y,q as k,b as A,o as w,j as N,g as U,f as K}from"./vue.esm-bundler-DAoQZYEK.js";import{e as x,b as P,i as B}from"./useForwardExpose-D9aka3cn.js";import{f as i,A as E,a as D,g as I,b,E as T,c as M}from"./utils-T_AZzJOL.js";import{P as R}from"./Primitive-Dw578XAm.js";function J(s){return s?"open":"closed"}function Q(s){const a=p();for(const t of s)if(t===a||(t.focus(),p()!==a))return}const V=x(()=>g([]));function $(){const s=V();return{add(a){const t=s.value[0];a!==t&&(t==null||t.pause()),s.value=O(s.value,a),s.value.unshift(a)},remove(a){var t;s.value=O(s.value,a),(t=s.value[0])==null||t.resume()}}}function O(s,a){const t=[...s],l=t.indexOf(a);return l!==-1&&t.splice(l,1),t}function j(s){return s.filter(a=>a.tagName!=="A")}const W=S({__name:"FocusScope",props:{loop:{type:Boolean,default:!1},trapped:{type:Boolean,default:!1},asChild:{type:Boolean},as:{}},emits:["mountAutoFocus","unmountAutoFocus"],setup(s,{emit:a}){const t=s,l=a,{currentRef:C,currentElement:h}=P(),v=g(null),F=$(),m=_({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}});y(n=>{if(!B)return;const e=h.value;if(!t.trapped)return;function o(c){if(m.paused||!e)return;const d=c.target;e.contains(d)?v.value=d:i(v.value,{select:!0})}function f(c){if(m.paused||!e)return;const d=c.relatedTarget;d!==null&&(e.contains(d)||i(v.value,{select:!0}))}function u(c){e.contains(v.value)||i(e)}document.addEventListener("focusin",o),document.addEventListener("focusout",f);const r=new MutationObserver(u);e&&r.observe(e,{childList:!0,subtree:!0}),n(()=>{document.removeEventListener("focusin",o),document.removeEventListener("focusout",f),r.disconnect()})}),y(async n=>{const e=h.value;if(await k(),!e)return;F.add(m);const o=p();if(!e.contains(o)){const u=new CustomEvent(E,T);e.addEventListener(E,r=>l("mountAutoFocus",r)),e.dispatchEvent(u),u.defaultPrevented||(D(j(I(e)),{select:!0}),p()===o&&i(e))}n(()=>{e.removeEventListener(E,c=>l("mountAutoFocus",c));const u=new CustomEvent(b,T),r=c=>{l("unmountAutoFocus",c)};e.addEventListener(b,r),e.dispatchEvent(u),setTimeout(()=>{u.defaultPrevented||i(o??document.body,{select:!0}),e.removeEventListener(b,r),F.remove(m)},0)})});function L(n){if(!t.loop&&!t.trapped||m.paused)return;const e=n.key==="Tab"&&!n.altKey&&!n.ctrlKey&&!n.metaKey,o=p();if(e&&o){const f=n.currentTarget,[u,r]=M(f);u&&r?!n.shiftKey&&o===r?(n.preventDefault(),t.loop&&i(u,{select:!0})):n.shiftKey&&o===u&&(n.preventDefault(),t.loop&&i(r,{select:!0})):o===f&&n.preventDefault()}}return(n,e)=>(w(),A(K(R),{ref_key:"currentRef",ref:C,tabindex:"-1","as-child":n.asChild,as:n.as,onKeydown:L},{default:N(()=>[U(n.$slots,"default")]),_:3},8,["as-child","as"]))}});export{W as _,Q as f,J as g};
