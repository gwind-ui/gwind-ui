import{r as m,s as h,G as b,q as P,d as B,c as p,C as T,b as F,o as S,j as x,g as W,f as D,H as k}from"./vue.esm-bundler-DAoQZYEK.js";import{i as C,b as I,o as _}from"./useForwardExpose-D9aka3cn.js";import{h as L}from"./handleAndDispatchCustomEvent-ChOKVcqp.js";import{P as A}from"./Primitive-Dw578XAm.js";const z="dismissableLayer.pointerDownOutside",R="dismissableLayer.focusOutside";function g(r,s){const n=s.closest("[data-dismissable-layer]"),t=r.dataset.dismissableLayer===""?r:r.querySelector("[data-dismissable-layer]"),a=Array.from(r.ownerDocument.querySelectorAll("[data-dismissable-layer]"));return!!(n&&(t===n||a.indexOf(t)<a.indexOf(n)))}function q(r,s,n=!0){var u;const t=((u=s==null?void 0:s.value)==null?void 0:u.ownerDocument)??(globalThis==null?void 0:globalThis.document),a=m(!1),i=m(()=>{});return h(o=>{if(!C||!b(n))return;const c=async v=>{const O=v.target;if(!(!(s!=null&&s.value)||!O)){if(g(s.value,O)){a.value=!1;return}if(v.target&&!a.value){let y=function(){L(z,r,w)};const w={originalEvent:v};v.pointerType==="touch"?(t.removeEventListener("click",i.value),i.value=y,t.addEventListener("click",i.value,{once:!0})):y()}else t.removeEventListener("click",i.value);a.value=!1}},E=window.setTimeout(()=>{t.addEventListener("pointerdown",c)},0);o(()=>{window.clearTimeout(E),t.removeEventListener("pointerdown",c),t.removeEventListener("click",i.value)})}),{onPointerDownCapture:()=>{b(n)&&(a.value=!0)}}}function H(r,s){var a;const n=((a=s==null?void 0:s.value)==null?void 0:a.ownerDocument)??(globalThis==null?void 0:globalThis.document),t=m(!1);return h(i=>{if(!C)return;const u=async o=>{if(!(s!=null&&s.value))return;await P(),await P();const c=o.target;!s.value||!c||g(s.value,c)||o.target&&!t.value&&L(R,r,{originalEvent:o})};n.addEventListener("focusin",u),i(()=>n.removeEventListener("focusin",u))}),{onFocusCapture:()=>t.value=!0,onBlurCapture:()=>t.value=!1}}const d=T({layersRoot:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),j=B({__name:"DismissableLayer",props:{disableOutsidePointerEvents:{type:Boolean,default:!1},asChild:{type:Boolean},as:{}},emits:["escapeKeyDown","pointerDownOutside","focusOutside","interactOutside","dismiss"],setup(r,{emit:s}){const n=r,t=s,{forwardRef:a,currentElement:i}=I(),u=p(()=>{var e;return((e=i.value)==null?void 0:e.ownerDocument)??globalThis.document}),o=p(()=>d.layersRoot),c=p(()=>i.value?Array.from(o.value).indexOf(i.value):-1),E=p(()=>d.layersWithOutsidePointerEventsDisabled.size>0),v=p(()=>{const e=Array.from(o.value),[f]=[...d.layersWithOutsidePointerEventsDisabled].slice(-1),l=e.indexOf(f);return c.value>=l}),O=q(async e=>{const f=[...d.branches].some(l=>l==null?void 0:l.contains(e.target));!v.value||f||(t("pointerDownOutside",e),t("interactOutside",e),await P(),e.defaultPrevented||t("dismiss"))},i),y=H(e=>{[...d.branches].some(l=>l==null?void 0:l.contains(e.target))||(t("focusOutside",e),t("interactOutside",e),e.defaultPrevented||t("dismiss"))},i);_("Escape",e=>{c.value===o.value.size-1&&(t("escapeKeyDown",e),e.defaultPrevented||t("dismiss"))});let w;return h(e=>{i.value&&(n.disableOutsidePointerEvents&&(d.layersWithOutsidePointerEventsDisabled.size===0&&(w=u.value.body.style.pointerEvents,u.value.body.style.pointerEvents="none"),d.layersWithOutsidePointerEventsDisabled.add(i.value)),o.value.add(i.value),e(()=>{n.disableOutsidePointerEvents&&d.layersWithOutsidePointerEventsDisabled.size===1&&(u.value.body.style.pointerEvents=w)}))}),h(e=>{e(()=>{i.value&&(o.value.delete(i.value),d.layersWithOutsidePointerEventsDisabled.delete(i.value))})}),(e,f)=>(S(),F(D(A),{ref:D(a),"as-child":e.asChild,as:e.as,"data-dismissable-layer":"",style:k({pointerEvents:E.value?v.value?"auto":"none":void 0}),onFocusCapture:D(y).onFocusCapture,onBlurCapture:D(y).onBlurCapture,onPointerdownCapture:D(O).onPointerDownCapture},{default:x(()=>[W(e.$slots,"default")]),_:3},8,["as-child","as","style","onFocusCapture","onBlurCapture","onPointerdownCapture"]))}});export{j as _,d as c};
